#!/usr/bin/env bash
set -euo pipefail

MODEL="zai-coding-plan/glm-5"
MAX_ITER=50

PROMPT=$(cat <<'PROMPT' 
–¢—ã –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞—á—É: –†–µ–∞–ª–∏–∑—É–π –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –ª–µ–Ω–¥–∏–Ω–≥ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–∞ –ø–æ AI-–¥–∏–∑–∞–π–Ω—É –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤ (weavy.ai) —Å—Ç—Ä–æ–≥–æ –ø–æ –¢–ó.

## üîÑ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω:

1. **–ò–∑—É—á–∏ prd.json** ‚Äî –≤—ã–±–µ—Ä–∏ US —Å "passes": false, –≤—ã—Å–æ–∫–∏–π priority
2. **–ü—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª—ã:** .ralph/ralph-prompt.md, AGENTS.md, .ralph/tasks/progress.txt, .ralph/ralph-tasks.md
3. **–†–µ–∞–ª–∏–∑—É–π** –∫–æ–¥ —Å–æ–≥–ª–∞—Å–Ω–æ acceptance_criteria –∏–∑ prd.json
4. **–ü—Ä–æ–≤–µ—Ä—å:** npm run typecheck, npm run lint ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ‚úÖ
5. **–û–±–Ω–æ–≤–∏ —Ñ–∞–π–ª—ã –≤ –°–¢–†–û–ì–û–ú –ø–æ—Ä—è–¥–∫–µ:**
   - –ü–ï–†–í–´–ú: prd.json ‚Üí "passes": true + "notes"
   - –í–¢–û–†–´–ú: ralph-tasks.md ‚Üí [x]
   - –¢–†–ï–¢–¨–ò–ú: progress.txt ‚Üí –∑–∞–ø–∏—Å—å —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –≤—ã–≤–µ–¥–∏ <promise>READY_FOR_NEXT_TASK</promise>

## üìÇ –§–∞–π–ª—ã:
- prd.json: .ralph/tasks/prd.json
- ralph-tasks.md: .ralph/ralph-tasks.md
- progress.txt: .ralph/tasks/progress.txt
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: .ralph/ralph-prompt.md

## ‚ö†Ô∏è –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π ‚Äî –°–û–ó–î–ê–ô:
- –ï—Å–ª–∏ .ralph/ralph-tasks.md –ø—É—Å—Ç–æ–π ‚Üí —Å–æ–∑–¥–∞–π —Å–ø–∏—Å–æ–∫ –∏–∑ prd.json (—Ñ–æ—Ä–º–∞—Ç: `- [ ] **US-XXX** –ù–∞–∑–≤–∞–Ω–∏–µ`)
- –ï—Å–ª–∏ .ralph/tasks/progress.txt –ø—É—Å—Ç–æ–π ‚Üí —Å–æ–∑–¥–∞–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `# Progress Log`
- –ï—Å–ª–∏ .ralph/tasks/prd.json –ø—É—Å—Ç–æ–π ‚Üí –∏–∑—É—á–∏ plans/ –∏ AGENTS.md, —Å–æ–∑–¥–∞–π prd.json —Å user_stories

## üìã –§–æ—Ä–º–∞—Ç progress.txt (–î–û–ë–ê–í–õ–Ø–ô –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞):
```markdown
## [2026-02-13 14:30] - US-XXX

‚úÖ –°–¥–µ–ª–∞–Ω–æ:
- –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: file1.ts, file2.ts

üß™ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- npm run typecheck ‚úÖ
- npm run lint ‚úÖ

‚ö†Ô∏è –†–∏—Å–∫–∏/–∑–∞–º–µ—Ç–∫–∏:
- –ß—Ç–æ —É—á–µ—Å—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
- –ò–∑—É—á–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:
- US-YYY: —Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞
```

## ‚ö° –°—Ç–µ–∫:
Next.js 16, React 19, Tailwind CSS v4, React Flow v12+, Framer Motion, shadcn/ui

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- AGENTS.md ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞
- plans/–õ–µ–Ω–¥–∏–Ω–≥ ‚Äî –¢–ó*.md ‚Äî –ø–æ–ª–Ω–æ–µ –¢–ó

## üö´ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é
- –ù–µ –∑–∞–≤–µ—Ä—à–∞–π –µ—Å–ª–∏ typecheck/lint –∫—Ä–∞—Å–Ω—ã–µ
- –ö–æ–º–º–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## ‚úÖ Self-check –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º:
- [ ] prd.json: passes: true
- [ ] ralph-tasks.md: [x]
- [ ] progress.txt: –∑–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] typecheck ‚úÖ, lint ‚úÖ

## üèÅ –§–∏–Ω–∞–ª:
–ö–æ–≥–¥–∞ –í–°–ï US passes: true ‚Üí –≤—ã–≤–µ–¥–∏ <promise>COMPLETE</promise>

–í–°–ï–ì–î–ê –æ—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π OpenCode –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.
PROMPT
)

exec ralph "$PROMPT" --max-iterations "$MAX_ITER" --tasks --model "$MODEL"
